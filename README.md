> [!WARNING]
> Although functional, this project is still under development. This README file will be updated as the project mover forward.

# Music Engine

A dynamic music library for Harmonizer 02, implemented in SuperCollider.

---

## Usage

A range may be generated by creating an instance of `MENoteRanges`, passing a chord symbol as argument. Chord symbol must be of type `String`:

```supercollider
~range = MENoteRanges.new("Gm3P5M6M7");
```

`MENoteRanges` generates an array of `MENotes` objects, that encapsulate all data for any given note.

```supercollider
~range.notes; // [a MENotes, a MENotes, a MENotes, a MENotes, ...]
```

We can inspect each note by calling on its properties:

```supercollider
~range.notes[19].degree     // m3
~range.notes[19].name       // Bb4
~range.notes[19].sol        // Sib4 (solfege naming convention)
~range.notes[19].accidental // b
~range.notes[19].midi       // 70
~range.notes[19].freq       // 466.16376151809
~range.notes[19].octave     // 4
```

We can return the name without the octave, when using the methods `name` and `sol`, by setting `withOctave` to false:

```supercollider
~range.notes[19].name(withOctave: false) // Bb
```

The `MENotes` object has additional properties that can be set by the user:

```supercollider
~range.notes[19].duration     = 1;
~range.notes[19].articulation = 0.99; // \legato
~range.notes[19].dynamic      = 0.5;
```

If we want to handle data directly, and not through a `MENotes` object, we can call on several `MENoteRanges` instance methods to get arrays for most of the properties found in `MENotes`:

```supercollider
~range.degrees; // [P5, M6, M7, Rt, ...]
~range.names;   // [D1, E1, F#1, G1, ...]
~range.sol;     // [Re1, Mi1, Fa#1, Sol1, ...]
~range.midi;    // [26, 28, 30, 31, ...]
~range.freq;    // [36.708095989676, 41.203444614109, 46.249302838954, ...]
```

Ranges may be filtered by specifying the first and last octaves, as well as from which degree the sequence should start:

```supercollider
~range.midi(fromOctave: 4, toOctave: 5, fromDegree: "Rt"); // [67, 70, 74, 76, 78, 79, 82]
```
This will start the sequence in _G4_, and end in the last note found in octave 5.

When setting this parameter, we should be mindful to only pick degrees present in the chord. If we choose a _M2_, as an example:

```supercollider
~range.midi(fromOctave: 4, toOctave: 5, fromDegree: "M2");
```

We will get the error:

```terminal
ERROR: Range does not include interval M2. Pick from Rt, m3, P5, M6, M7.

CALL STACK:
	Exception:reportError
    (...)
```

## Chord Symbols

The symbol may be build using a verbose syntax, where all intervals are discriminated following a root, or by appending a conventional symbol to a root.

> [!NOTE]
> See the [Chord Symbols](https://github.com/iamsiriil/sc_musicengine/wiki/Chord-Symbols) wiki page for reference on which conventional chord symbols are allowed.

As to the verbose syntax, the following rules apply:

#### Symbol structure

Chords may be described by:
* Referencing the root note (A-G), with or without accidentals (#/b)
* using a letter to describe degree type (d, m, P, M, A) and
* using an integer to represent degree (2-7, 9-14)

#### Allowed Intervals

Depending on the degree, an interval may be diminished, minor, perfect, major or augmented. Represented, respectively, with: d, m, P, M, A.

| **Degree** | **Type** |
|----------|-----------------------|
| 2nd/9th | m, M, A |
| 7th/14th | d, m, M |
| 3rd/10th; 6th/13th | d, m, M, A |
| 4th/11th; 5th/12th | d, P, A |

##### Common Chord Examples

```supercollider
"Dbm3P5"           // Minor triad, over Db
"FM3P5m7"          // Dominant seventh chord, over F
"BbM3P5M7M9P11M13" // Major seventh chord with added ninth, eleventh and thirteenth, over Bb
"GM2P5m7"          // Sus2 dominant seventh chord, over G
```

##### Less Common Chord Examples

```supercollider
"EbP4m7"          // Quartal triad, over Eb
"D#P5M9"          // Quintal triad, over D#
"Ed3d5d7"         // German sixth in root position, over E
```

---

## Rules

* Unison and octave are not allowed when specifying chord degrees.
* Chord note number may range from two to ~~seven~~ twelve.
* ~~Degree clashes are not allowed (m2/M2, P4/A11, etc.).~~
* Note clashes are not allowed (m3/A9, A4/d5, etc.).
* Diminished seconds and augmented sevenths are not allowed, since they clash with the root.
* Roots with double sharps or flats are not allowed, other than that, any chord formation can be written over any root, provided non of the chord notes reaches a forth flat/sharp (B# or C, F# or Gb, F or E#, etc.). MusicEngine should be able to handle enharmonics accordingly and name all notes correctly.

## Validity Tests

* Contains root at the start (A-G, #/b)
* Contains only the numbers 2-7, 9-14
* Contains only the letters d, m, P, M, A
* No consecutive numbers without type descriptor
* No consecutive letters without numbers
* Numbers are prefixed with a valid descriptor, given the degree they represent
